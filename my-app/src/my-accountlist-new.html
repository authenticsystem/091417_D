<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="short-unique-id.html">

<dom-module id="my-accountlist-new">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            app-header {
                color: rgb(255, 255, 255);
                background-color: #673AB7;
            }

            app-header paper-icon-button {
                --paper-icon-button-ink-color: #000000;
            }

            app-drawer-layout:not([narrow]) [drawer-toggle] {
                display: none;
            }

            app-drawer {
                --app-drawer-content-container: {
                    background-color: #F4F5F6;
                }
            }

            @media (min-width: 800px) {
                .docu {
                    padding: 16px;
                }
            }

            paper-button.indigo {
                background: white;
                height: 32px;
                font-size: 12px;
                font-weight: 400;
                background: green;
                color: white;
                width: 80px;
            }

            paper-button.cancel {
                background: white;
                height: 32px;
                font-size: 12px;
                font-weight: 400;
                width: 80px;
                text-decoration: none;
            }

            paper-button.ok {
                background: white;
                height: 32px;
                font-size: 12px;
                font-weight: 400;
                width: 80px;
                text-decoration: none;
                float: right;
            }

            paper-toast {
                width: 20%;
                position: fixed;
                bottom: 1opx;
                left: 10px;
                margin-left: 20%;
            }

            paper-checkbox {
                font-size: 14px;
                margin-right: 5px;
            }
        </style>

        <firebase-query id="query" path="{{getpath()}}" data="{{account}}"></firebase-query>

        <app-drawer-layout fullbleed narrow="{{narrow}}" id="drawerLayout">
            <app-header-layout id="appheader" has-scrolling-region>
                <app-header fixed slot="header">
                    <app-toolbar>
                        <a href="/accountlist">
                            <paper-icon-button noink class="menu" style="color: white;" icon="my-icons:arrow-back"></paper-icon-button>
                        </a>
                        <div main-title>New Account</div>
                        <paper-icon-button drawer-toggle icon="my-icons:menu"></paper-icon-button>
                    </app-toolbar>
                </app-header>

                <div class="docu" hidden$="[[firstStep]]">

                    <div class="details">
                        <paper-input readonly="true" value="{{accountkey}}" always-float-label label="Account Code"></paper-input>
                        <!-- <div style="font-size:12px; margin-top:1em;">Prefix
                            <span id="rPrefix" style="color:red;display:none;">*</span>
                        </div>
                        <paper-radio-group style="font-size:14px;" selected="{{prefix}}">
                            <paper-radio-button name="Mr">Mr</paper-radio-button>
                            <paper-radio-button name="Ms">Ms</paper-radio-button>
                            <paper-radio-button name="Mrs">Mrs</paper-radio-button>
                        </paper-radio-group> -->
                        <paper-input required auto-validate pattern="[a-zA-Z-.-/ ]*" value="{{prefix}}" always-float-label label="Designatory letters"></paper-input>
                        <paper-input required auto-validate pattern="[a-zA-Z-. ]*" value="{{firstname}}" always-float-label label="First Name"></paper-input>
                        <paper-input auto-validate="true" pattern="[a-zA-Z-. ]*" value="{{middlename}}" always-float-label label="Middle Name"></paper-input>
                        <paper-input required auto-validate="true" pattern="[a-zA-Z-. ]*" value="{{lastname}}" always-float-label label="Last Name"></paper-input>
                        <paper-input auto-validate="true" pattern="[a-zA-Z-. ]*" value="{{suffix}}" always-float-label label="Suffix"></paper-input>
                        <paper-input required allowed-pattern="[\d]" prevent-invalid-input char-counter maxlength="10" value="{{cellphone}}" always-float-label
                            label="Cellphone">
                            <div slot="prefix">+63</div>
                        </paper-input>
                        <paper-dropdown-menu vertical-align="bottom" style="cursor:pointer; width:100%" label="Role">
                            <paper-listbox slot="dropdown-content" class="dropdown-content" selected="{{roleSelect}}">
                                <paper-item>Doctor</paper-item>
                                <!-- <paper-item>Secretary</paper-item> -->
                                <paper-item>System Admin</paper-item>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <!-- <br>
                        <div style="font-size:12px; margin-top:1em;">Access</div>
                        <paper-checkbox id="dash">Dashboard</paper-checkbox>
                        <paper-checkbox id="app">Applications</paper-checkbox>
                        <paper-checkbox id="acc">Accounts</paper-checkbox> -->
                        <!-- <paper-checkbox noink value="{{checked}}" >Allow Access</paper-checkbox> -->
                    </div>
                    <br>
                    <span id="errorMsgDiv" style="color: rgb(36, 36, 36); font-size:13px; float:right; display:none;">
                        <b>Error!</b> {{msg}}</span>
                    <paper-button id="favleft" class="indigo" on-click="_submit" raised>Add</paper-button>
                    <a href="/accountlist" style="text-decoration:none">
                        <paper-button id="favright" class="cancel">Cancel</paper-button>
                    </a>
                </div>

                <div class="docu" hidden$="[[finalstepHide]]">
                    <div class="docu-header">Account Successfully Added.
                        <span style="float:right">
                            <paper-icon-button noink class="menu" icon="my-icons:print" on-click="_print"></paper-icon-button>
                        </span>
                    </div>
                    <div class="details" id="printMe">
                        <div>Account Code. {{accountkey}}</div>
                        <div style="text-transform:capitalize;">Name: {{prefix}} {{firstname}} {{middlename}} {{lastname}} {{suffix}}</div>
                        <div>Contact No. +63{{cellphone}}</div>
                    </div>
                </div>

            </app-header-layout>
        </app-drawer-layout>
    </template>

    <script>
        Polymer({
            is: 'my-accountlist-new',
            properties: {
                firstStep: {
                    type: Boolean,
                    value: false
                },
                finalstepHide: {
                    type: Boolean,
                    value: true
                },
                account: {
                    type: Object,
                },
                equal: {
                    type: String,
                    value: ''
                },
                accountkey: {
                    type: String,
                    value: ''
                },
                selectedItem: {
                    observer: '_selectedItemChanged'
                },
                selectedItems: {
                    type: Object,
                },
                keyS: {
                    type: String,
                    value: ''
                },
                roleSelect: {
                    type: Number,
                    observer: 'roleSelectChanged'
                },
                msg: {
                    type: String,
                    observer: '_msgChanged'
                },
                role: String
            },

            _msgChanged() {
                if (this.msg) {
                    Polymer.dom(this.root).querySelector("#errorMsgDiv").style.display = 'block';
                }
                else {
                    Polymer.dom(this.root).querySelector("#errorMsgDiv").style.display = 'none';
                }
            },

            roleSelectChanged() {
                if (this.roleSelect == 0) {
                    this.role = 'Doctor';
                    // Polymer.dom(this.root).querySelector("#dash").checked = true;
                    // Polymer.dom(this.root).querySelector("#app").checked = true;
                    // Polymer.dom(this.root).querySelector("#acc").checked = true;
                }
                // else if (this.roleSelect == 1) {
                //     this.role = 'Secretary';
                // Polymer.dom(this.root).querySelector("#dash").checked = false;
                // Polymer.dom(this.root).querySelector("#app").checked = true;
                // Polymer.dom(this.root).querySelector("#acc").checked = false;
                // }
                else {
                    this.role = 'System Admin';
                }
            },

            _print() {
                var content = Polymer.dom(this.root).querySelector("#printMe").innerHTML;
                var mywindow = window.open('', 'Print', 'height=600,width=800');
                mywindow.document.write(content);
                mywindow.print();
            },

            getpath() {
                this.accountkey = this.guid();
                this.path = 'accountlist/' + this.accountkey;
                return this.path;
            },

            guid: function () {
                var uid = new ShortUniqueId();
                return uid.randomUUID(7);
            },

            _submit() {
                if (!this.firstname || !this.lastname || !this.prefix) {
                    if (!this.firstname) this.firstname = '';
                    if (!this.lastname) this.lastname = '';
                    if (!this.prefix) this.prefix = '';
                    this.msg = 'Please fill-up the required field.';
                }
                else if (!this.cellphone) {
                    this.msg = 'Please enter cellphone number.';
                }
                else if (!this.role) {
                    this.msg = 'Please select a role.';
                }
                // else if () {
                //     this.msg = 'Please enter your designatory letters.';
                //     // Polymer.dom(this.root).querySelector("#rPrefix").style.display = 'inline-block';
                // }
                else {
                    // Polymer.dom(this.root).querySelector("#rPrefix").style.display = 'none';
                    if (this.cellphone.length != 10) {
                        this.msg = 'Invalid cellphone number.';
                    }
                    else {
                        this.msg = '';

                        if (!this.suffix) {
                            this.suffix = '';
                        }

                        if (!this.middlename) {
                            this.middlename = '';
                        }

                        var ref = firebase.database().ref("/accounts");
                        var push = ref.push({
                            code: this.accountkey,
                            active: false,
                            name: {
                                firstname: this.firstname,
                                middlename: this.middlename,
                                lastname: this.lastname,
                                suffix: this.suffix
                            },
                            role: this.role,
                            designatory: this.prefix,
                            cellphone: this.cellphone,
                            uid: ''
                        });

                        if (push.key) {
                            this.finalstepHide = false;
                            this.firstStep = true;
                        }
                    }
                }
            }

        })
    </script>
</dom-module>