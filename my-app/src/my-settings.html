<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="short-unique-id.html">

<link rel="lazy-import" href="my-account.html">
<link rel="lazy-import" href="my-secretary.html">
<link rel="lazy-import" href="my-services.html">
<link rel="lazy-import" href="my-hmo.html">

<dom-module id="my-settings">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                padding: 10px;
            }

            app-header {
                color: rgb(255, 255, 255);
                background-color: #673AB7;
            }

            paper-icon-button.menu {
                margin-right: 16px;
            }

            @media (max-width: 768px) {
                .div1 {
                    text-align: center
                }

                /*.div2{
                    flex:2; padding: 25px;
                } */
                .divHolder {
                    display: block;
                }

                paper-menu-button {
                    float: right;
                    bottom: 16px;
                }
            }

            @media (min-width: 768px) {
                .div1 {
                    flex: 1;
                }

                .div2 {
                    flex: 2;
                    padding: 25px;
                }

                .divHolder {
                    display: flex;
                }

                paper-menu-button {
                    float: right;
                    bottom: 26px;
                }
            }

            a {
                text-decoration: none;
                /* background: yellow; */
                /* padding: 2px;
                border-radius: 3px;
                font-weight: 500; */
            }

            paper-button {
                height: 32px;
                font-size: 12px;
                font-weight: 400;
                width: 80px;
            }

            .green {
                background: green;
                color: white
            }

            .card:hover {
                box-shadow: 0 6px 12px 0 rgba(0, 0, 0, 0.2);
                cursor: pointer;
            }
        </style>

        <app-route route="{{route}}" pattern="/account" active="{{accountActive}}"></app-route>
        <app-route route="{{route}}" pattern="/secretary" active="{{secretaryActive}}"></app-route>
        <app-route route="{{route}}" pattern="/services" active="{{servicesActive}}"></app-route>
        <app-route route="{{route}}" pattern="/hmo" active="{{hmoActive}}"></app-route>

        <iron-pages selected="[[route.path]]" attr-for-selected="name" fallback-selection="view404" role="main">
            <div name="">
                <app-header-layout fullbleed has-scrolling-region>
                    <app-header fixed slot="header">
                        <app-toolbar primary>
                            <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button>
                            <div main-title>Settings</div>
                        </app-toolbar>
                    </app-header>

                    <div class="divHolder">
                        <div class="div1" align="center">
                            <div on-tap="_newAccount" class="card">
                                <img style="width:150px; height:150px; border-radius:50%;" src="../images/user.png">
                                <h3>My Account</h3>
                            </div>
                        </div>
                        <div hidden="{{isSecretary}}" class="div1" align="center">
                            <div on-tap="_newSecretary" class="card">
                                <img preload style="width:150px; height:150px;" src="../images/secretary.png">
                                <h3>My Secretary</h3>
                            </div>
                        </div>
                    </div>
                    <div class="divHolder">
                        <div hidden="{{isSecretary}}" class="div1" align="center">
                            <div on-tap="_newServices" class="card">
                                <img style="width:150px; height:150px; border-radius:50%;" src="../images/services.png">
                                <h3>My Services</h3>
                            </div>
                        </div>
                        <div hidden="{{isSecretary}}" class="div1" align="center">
                            <div on-tap="_newHMO" class="card">
                                <img style="width:150px; height:150px; border-radius:50%;" src="../images/hmo.png">
                                <h3>My HMO</h3>
                            </div>
                        </div>
                    </div>

                </app-header-layout>
            </div>

            <div name="/account">
                <template is="dom-if" if="{{accountActive}}" restamp>
                    <my-account id="acc2" user="{{user}}"></my-account>
                </template>
            </div>

            <div name="/secretary">
                <template is="dom-if" if="{{secretaryActive}}" restamp>
                    <my-secretary id="sec2" my-key="{{myKey}}" my-lastname="{{myLastname}}"></my-secretary>
                </template>
            </div>

            <div name="/services">
                <template is="dom-if" if="{{servicesActive}}" restamp>
                    <my-services id="ser2" my-key="{{myKey}}" my-role="{{myRole}}"></my-services>
                </template>
            </div>

            <div name="/hmo">
                <template is="dom-if" if="{{hmoActive}}" restamp>
                    <my-hmo id="hmo2" my-key="{{myKey}}" my-role="{{myRole}}"></my-hmo>
                </template>
            </div>

            <div name="view404">Not found.</div>
        </iron-pages>

        <!-- <paper-dialog id="reAuth" confirm-button="Done">
            <h3 style="margin-bottom:-1em;">Re-authentication required</h3>
            <div style="color:red; font-size:13px;margin-bottom:-1em;">{{validationMessage}}</div>
            <paper-input on-keyup="_ack" style="margin-bottom:-1em;" label="Email" value="{{email}}" always-float-label id="email"></paper-input>
            <paper-input on-keyup="_ack" label="Password" always-float-label type="password" value={{password}} id="email"></paper-input>
            <div class="buttons" style="text-align:center">
                <div class="action">
                    <paper-spinner id="nextSpinner" active style="top:7px; display:none;"></paper-spinner> -->
        <!-- <paper-button style="background:rgb(207, 206, 206);color:black" dialog-confirm autofocus>Cancel</paper-button> 
                    <paper-button id="nextBtn" on-tap="_update" style="background:rgb(207, 206, 206);">Submit</paper-button>
                </div>
            </div>
        </paper-dialog>-->

    </template>

    <script>
        Polymer({
            is: 'my-settings',
            properties: {
                account: {
                    type: Object,
                },
                route: {
                    type: Object,
                    observer: '_routeChanged'
                },
                user: Object,
                myKey: String,
                myLastname: String,
                myRole: {
                    type: String,
                    observer: '_myRoleChanged'
                },
                isSecretary: {
                    type: Boolean,
                    value: true
                }
            },

            _routeChanged(e) {
                var page;
                if (this.accountActive) page = "account";
                else if (this.secretaryActive) page = "secretary";
                else if (this.servicesActive) page = "services";
                else if (this.hmoActive) page = "hmo";

                if (page) {
                    var resolvedPageUrl = this.resolveUrl('my-' + page + '.html');
                    Polymer.importHref(resolvedPageUrl);
                }
            },

            _newAccount() {
                window.history.pushState({}, null, '/settings/account');
                window.dispatchEvent(new CustomEvent('location-changed'));
                this.dispatchEvent(new CustomEvent('loadPage', {
                    bubbles: true, composed: true, detail: "account"
                }));
            },

            _newSecretary() {
                window.history.pushState({}, null, '/settings/secretary');
                window.dispatchEvent(new CustomEvent('location-changed'));
                this.dispatchEvent(new CustomEvent('loadPage', {
                    bubbles: true, composed: true, detail: "secretary"
                }));
            },

            _newServices() {
                window.history.pushState({}, null, '/settings/services');
                window.dispatchEvent(new CustomEvent('location-changed'));
                this.dispatchEvent(new CustomEvent('loadPage', {
                    bubbles: true, composed: true, detail: "services"
                }));
            },

            _newHMO() {
                window.history.pushState({}, null, '/settings/hmo');
                window.dispatchEvent(new CustomEvent('location-changed'));
                this.dispatchEvent(new CustomEvent('loadPage', {
                    bubbles: true, composed: true, detail: "hmo"
                }));
            },

            _myRoleChanged() {
                if (this.myRole == 'Secretary') this.isSecretary = true;
                else this.isSecretary = false;
            },

            toggleDrawer() {
                this.dispatchEvent(new CustomEvent('toggleDrawer', {
                    bubbles: true, composed: true, detail: {
                        narrow: this.$.narrow
                    }
                }));
                this.$.narrow = !this.$.narrow;
            }
        })


    </script>
</dom-module>