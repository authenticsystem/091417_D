<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-behavior.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="short-unique-id.html">

<dom-module id="my-patients-edit">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

      app-header {
        color: rgb(255, 255, 255);
        background-color: #673AB7;
      }

      paper-icon-button.menu {
        margin-right: 16px;
      }

      app-drawer-layout:not([narrow]) [drawer-toggle] {
        display: none;
      }

      app-drawer {
        --app-drawer-content-container: {
          background-color: #F4F5F6;
        }
      }

      paper-item {
        height: 64px;
      }

      paper-item:hover {
        background: rgba(104, 58, 183, 0.26);
        cursor: pointer;
      }

      #item {
        height: 0;
      }

      .mnu {
        padding: 13px;
      }

      @media (min-width: 800px) {
        .footer {
          position: absolute;
          bottom: 16px;
          width: 100%;
        }
        .paper-fab-0 {
          position: absolute;
          left: 48px;
          bottom: 48px;
        }

        .paper-fab-1 {
          position: absolute;
          right: 48px;
          bottom: 48px;
        }

        #info {
          display: flex;
        }
      }

      @media (max-width: 800px) {
        .paper-fab-0 {
          position: absolute;
          left: 16px;
          bottom: 48px;
        }

        .paper-fab-1 {
          position: absolute;
          right: 16px;
          bottom: 48px;
        }

        .docu {
          margin-left: 16px;
          margin-right: 16px;
        }
      }

      .avatar {
        height: 50px;
        width: 50px;
        border-radius: 50%;
        box-sizing: border-box;
        background-color: #DDD;
      }
    </style>

    <app-drawer-layout fullbleed narrow="{{narrow}}" id="drawerLayout">
      <app-drawer id="drawer" slot="drawer" swipe-open="[[narrow]]" align="right">
        <div class="mnu" role="listbox">
          <!-- <iron-selector attr-for-selected="value" class="drawer-list"> -->
          <!-- on-tap="_selectPage" data-args="1" -->
          <paper-item id="buyersinformation">
            <div class="circle-mini-first">1</div>
            <span>Profile Picture</span>
          </paper-item>

          <!-- on-tap="_selectPage" data-args="2" -->
          <paper-item id="samplecomputation">
            <div class="circle-mini">2</div>
            <span>Basic Information</span>
          </paper-item>

          <!-- on-tap="_selectPage" data-args="3" -->
          <paper-item id="finalize">
            <div class="circle-mini">3</div>
            <span>Insurance</span>
          </paper-item>

          <!-- on-tap="_selectPage" data-args="4" -->
          <paper-item id="complete">
            <div class="circle-mini">4</div>
            <span>In-case of Emergency</span>
          </paper-item>

          <paper-item id="complete">
            <div class="circle-mini">5</div>
            <span>Finalize</span>
          </paper-item>

          <paper-item id="complete">
            <div class="circle-mini-last">6</div>
            <span>Completed</span>
          </paper-item>
          <!-- </iron-selector> -->
        </div>
      </app-drawer>


      <app-header-layout id="appheader" has-scrolling-region>
        <app-header fixed slot="header">
          <app-toolbar>
            <a href="/patients">
              <paper-icon-button noink class="menu" style="color: white;" icon="my-icons:arrow-back"></paper-icon-button>
            </a>
            <div main-title>Edit Patient</div>
            <!-- <paper-menu-button horizontal-align="right">
              <paper-icon-button noink style="color: white; margin-right:-15px;" icon="my-icons:more-vert" slot="dropdown-trigger" alt="bottom align"></paper-icon-button>
              <paper-listbox slot="dropdown-content" style="cursor:pointer">
                <paper-item>
                  <a style="text-decoration:none" href="/patients">Discard</a>
                </paper-item>
                <paper-item on-tap="_openDelete">Delete</paper-item>
              </paper-listbox>
            </paper-menu-button> -->
            <!-- <paper-icon-button noink style="color: white;" icon="my-icons:menu" on-tap="drawer.toggle()"></paper-icon-button> -->
            <!-- <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button> -->
          </app-toolbar>
        </app-header>

        <firebase-query id="query" path="/{{myKey}}/patients" order-by-key equal-to="{{editKey}}" data="{{mypatient}}">
        </firebase-query>

        <neon-animated-pages selected="{{selectedPage}}" entry-animation="{{entryanimation}}" exit-animation="{{exitanimation}}">

          <neon-animatable>
            <div class="docu">

              <div class="docu-header">
                <span>1. Profile Picture</span>
              </div>

              <div class="details" style="text-align:center">

                <img id="profilePic" style="width:200px; height:200px; border-radius:50%;" src="{{p_profile}}">
                <br>
                <div class="upload-btn-wrapper">
                  <button class="btn">Upload profile picture</button>
                  <input on-change="_changepic" type="file" name="myfile" accept="image/*" />
                </div>
              </div>
            </div>
          </neon-animatable>

          <neon-animatable>

            <div class="docu">
              <div class="docu-header">
                <span>2. Basic Information</span>
              </div>

              <div class="details">
                <div id="info">
                  <paper-input id="fname" value="{{fname}}" label="Firstname *" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input id="mname" value="{{mname}}" label="Middlename *" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input id="lname" value="{{lname}}" label="Lastname *" style="width:100%"></paper-input>
                </div>
                <paper-input id="email" value="{{email}}" label="E-mail Address"></paper-input>
                <div id="info">
                  <paper-input type="date" value="{{bday}}" label="Birth date" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input type="number" value="{{age}}" label="Age" style="width:100%;"></paper-input>
                </div>
                <div id="info">
                  <paper-dropdown-menu-light label="Marital Status" style="width:100%; margin-right:10px">
                    <paper-listbox slot="dropdown-content" style="cursor:pointer" selected="{{status}}" class="dropdown-content">
                      <paper-item id="item">Single</paper-item>
                      <paper-item id="item">Married</paper-item>
                      <paper-item id="item">Divorced</paper-item>
                      <paper-item id="item">Separated</paper-item>
                      <paper-item id="item">Widowed</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu-light>
                  <paper-dropdown-menu-light label="Sex" style="width:100%; margin-right:10px">
                    <paper-listbox slot="dropdown-content" style="cursor:pointer" selected="{{sex}}" class="dropdown-content">
                      <paper-item id="item">Male</paper-item>
                      <paper-item id="item">Female</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu-light>
                  <paper-input type="number" value="{{contact}}" label="Contact Number" style="width:100%;"></paper-input>
                </div>
                <paper-input value="{{address}}" label="Street Address"></paper-input>
                <paper-input value="{{occupation}}" label="Occupation"></paper-input>
                <div id="info">
                  <paper-input value="{{employer}}" label="Employer" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input value="{{emp_phone}}" type="number" label="Employer Phone no." style="width:100%"></paper-input>
                </div>
                <br>
                <span>Referred to clinic by (choose one)</span>
                <div id="info">
                  <paper-radio-group style="font-size:14px;" selected="{{refer}}">
                    <paper-radio-button name="Dr">Dr</paper-radio-button>
                    <paper-radio-button name="Insurance plan">Insurance plan</paper-radio-button>
                    <paper-radio-button name="Hospital">Hospital</paper-radio-button>
                  </paper-radio-group>
                </div>
                <paper-input style="margin-top:-15px; display:none" id="doctor" value="{{doctor}}" label="Dr."></paper-input>
              </div>
            </div>
            <br>
            <br>
            <br>
          </neon-animatable>

          <neon-animatable>
            <div class="docu">

              <div class="docu-header">
                <span>3. Insurance</span>
              </div>

              <div class="details">
                <div id="info">
                  <paper-input value="{{card}}" Label="ID Card Number" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input value="{{bdate}}" type="date" Label="Birth date" style="width:100%;"></paper-input>
                </div>
                <paper-input value="{{in_address}}" Label="Address (If different)"></paper-input>
                <paper-input value="{{home_phone}}" type="number" Label="Home phone no."></paper-input>
                <paper-input value="{{indicate}}" Label="Please indicate primary insurance"></paper-input>
                <paper-input value="{{p_relation}}" Label="Relationship to patient"></paper-input>
              </div>

            </div>
          </neon-animatable>

          <neon-animatable>
            <div class="docu">

              <div class="docu-header">
                <span>4. In-case of emergency</span>
              </div>

              <div class="details">
                <div id="info">
                  <paper-input value="{{name_e}}" label="Name of local friend or relative" style="width:100%; margin-right:10px"></paper-input>
                  <paper-input value="{{relation_e}}" label="Relationship to patient" style="width:100%;"></paper-input>
                </div>
                <div id="info">
                  <paper-input value="{{phone_e}}" type="number" label="Home phone no." style="width:100%; margin-right:10px"></paper-input>
                  <paper-input value="{{work_phone}}" type="number" label="Work phone no" style="width:100%;"></paper-input>
                </div>
              </div>

            </div>
          </neon-animatable>

          <neon-animatable>
            <div class="docu">
              <div class="docu-header">5. Finalize</div>

              <div class="details">
                <div style="margin-bottom:10px;">Please review the following details:</div>
                <img src="{{p_profile}}" class="avatar">

                <div style="font-weight:bold">Basic Information</div>
                <table>
                  <tr>
                    <td>Email address</td>
                    <td>:</td>
                    <td>{{email}}</td>
                  </tr>
                  <tr>
                    <td>Firstname</td>
                    <td>:</td>
                    <td>{{fname}}</td>
                  </tr>
                  <tr>
                    <td>Middlename</td>
                    <td>:</td>
                    <td>{{mname}}</td>
                  </tr>
                  <tr>
                    <td>Lastname</td>
                    <td>:</td>
                    <td>{{lname}}</td>
                  </tr>
                  <tr>
                    <td>Birth date</td>
                    <td>:</td>
                    <td>{{bday}}</td>
                  </tr>
                  <tr>
                    <td>Age</td>
                    <td>:</td>
                    <td>{{age}}</td>
                  </tr>
                  <tr>
                    <td>Marital Status</td>
                    <td>:</td>
                    <td>{{stat}}</td>
                  </tr>
                  <tr>
                    <td>Sex</td>
                    <td>:</td>
                    <td>{{gender}}</td>
                  </tr>
                  <tr>
                    <td>Contact no</td>
                    <td>:</td>
                    <td>{{contact}}</td>
                  </tr>
                  <tr>
                    <td>Street address</td>
                    <td>:</td>
                    <td>{{address}}</td>
                  </tr>
                  <tr>
                    <td>Occupation</td>
                    <td>:</td>
                    <td>{{occupation}}</td>
                  </tr>
                  <tr>
                    <td>Employer</td>
                    <td>:</td>
                    <td>{{occupation}}</td>
                  </tr>
                  <tr>
                    <td>Employer phone no</td>
                    <td>:</td>
                    <td>{{emp_phone}}</td>
                  </tr>
                  <tr>
                    <td>Referred to clinic by</td>
                    <td>:</td>
                    <td>{{referredby}}</td>
                  </tr>
                </table>

                <br>
                <div style="font-weight:bold">Insurance</div>
                <table>
                  <tr>
                    <td>ID Card no</td>
                    <td>:</td>
                    <td>{{card}}</td>
                  </tr>
                  <tr>
                    <td>Birth date</td>
                    <td>:</td>
                    <td>{{bdate}}</td>
                  </tr>
                  <tr>
                    <td>address</td>
                    <td>:</td>
                    <td>{{in_address}}</td>
                  </tr>
                  <tr>
                    <td>Relationship to patient</td>
                    <td>:</td>
                    <td>{{p_relation}}</td>
                  </tr>
                </table>

                <br>
                <div style="font-weight:bold">In-case of emergency</div>
                <table>
                  <tr>
                    <td>Name</td>
                    <td>:</td>
                    <td>{{name_e}}</td>
                  </tr>
                  <tr>
                    <td>Relationship to patient</td>
                    <td>:</td>
                    <td>{{relation_e}}</td>
                  </tr>
                  <tr>
                    <td>Home phone no</td>
                    <td>:</td>
                    <td>{{phone_e}}</td>
                  </tr>
                  <tr>
                    <td>Work phone no</td>
                    <td>:</td>
                    <td>{{work_phone}}</td>
                  </tr>
                </table>

                <!-- <div style="margin-bottom:10px;">Please review the following details:</div>
                <div style="font-weight:bold">Basic Information</div>
                <div style="margin-left:10px;">
                  <div>Email address: {{email}}</div>
                  <div>Firstname: {{fname}}</div>
                  <div>Middlename: {{mname}}</div>
                  <div>Lastname: {{lname}}</div>
                  <div>Birth date: {{bday}}</div>
                  <div>Age: {{age}}</div>
                  <div>Marital Status: {{stat}}</div>
                  <div>Sex: {{gender}}</div>
                  <div>Contact no: {{contact}}</div>
                  <div>Street address: {{address}}</div>
                  <div>Occupation: {{occupation}}</div>
                  <div>Employer: {{employer}}</div>
                  <div>Employer phone no: {{emp_phone}}</div>
                </div>
                <div style="font-weight:bold">Insurance</div>
                <div style="margin-left:10px;">
                  <div>ID Card no: {{card}}</div>
                  <div>Birth date: {{bdate}}</div>
                  <div>address: {{in_address}}</div>
                  <div>Home phone no: {{home_phone}}</div>
                  <div>Primary insurance: {{indicate}}</div>
                  <div>Relationship to patient: {{p_relation}}</div>
                </div>
                <div style="font-weight:bold">In-case of emergency</div>
                <div style="margin-left:10px;">
                  <div>Name: {{name_e}}</div>
                  <div>Relationship to patient: {{relation_e}}</div>
                  <div>Home phone no: {{phone_e}}</div>
                  <div>Work phone no: {{work_phone}}</div>
                </div> -->
              </div>
            </div>
          </neon-animatable>

          <neon-animatable>
            <div class="docu">
              <div class="docu-header">6. Completed</div>

              <div class="details">
                <paper-item>
                  <paper-item-body>
                    <div id="saveSuccess" style="color: green;">{{saveSuccess}}</div>
                    <div id="saveFailed" style="color: red;">{{saveError}}</div>
                  </paper-item-body>
                </paper-item>

              </div>
            </div>
          </neon-animatable>

        </neon-animated-pages>

      </app-header-layout>

      <div class="footer">
        <div hidden$="[[favlefthide]]">
          <paper-fab style="background: #1976d2;" id="favleft" class="paper-fab-0" icon="my-icons:chevron-left" on-tap="_select1"></paper-fab>
        </div>
        <div hidden$="[[favrighthide]]">
          <paper-fab style="background: #1976d2;" id="favright" class="paper-fab-1" icon="my-icons:chevron-right" on-tap="_select2"></paper-fab>
        </div>
      </div>

    </app-drawer-layout>

  </template>

  <script>
    Polymer({
      is: 'my-patients-edit',

      properties: {
        narrow: {
          type: Boolean,
          notify: true
        },
        myKey: String,
        selectedPage: Number,
        entryanimation: {
          type: String,
          value: "slide-from-right-animation"
        },
        exitanimation: {
          type: String,
          value: "slide-left-animation"
        },
        favlefthide: {
          type: Boolean,
          value: true
        },
        favrighthide: {
          type: Boolean,
          value: true
        },
        email: {
          type: String,
          value: ''
        },
        bday: {
          type: String,
          value: ''
        },
        age: {
          type: String,
          value: ''
        },
        contact: {
          type: String,
          value: ''
        },
        address: {
          type: String,
          value: ''
        },
        occupation: {
          type: String,
          value: ''
        },
        employer: {
          type: String,
          value: ''
        },
        emp_phone: {
          type: String,
          value: ''
        },
        gender: {
          type: String,
          value: ''
        },
        stat: {
          type: String,
          value: ''
        },
        doctor: {
          type: String,
          value: ''
        },

        card: {
          type: String,
          value: ''
        },
        bdate: {
          type: String,
          value: ''
        },
        in_address: {
          type: String,
          value: ''
        },
        home_phone: {
          type: String,
          value: ''
        },
        indicate: {
          type: String,
          value: ''
        },
        p_relation: {
          type: String,
          value: ''
        },

        name_e: {
          type: String,
          value: ''
        },
        relation_e: {
          type: String,
          value: ''
        },
        phone_e: {
          type: String,
          value: ''
        },
        work_phone: {
          type: String,
          value: ''
        },
        profile: String,
        editKey: String,
        personal: Object,
        insurance: Object,
        emergency: Object,
        mypatient: Object
      },

      observers: [
        'personalInfoChanged(doctor,refer,email,fname,mname,lname,bday,age,contact,address,occupation,employer,emp_phone,sex,status)',
        'insuranceChanged(card, bdate, in_address, home_phone, indicate, p_relation)',
        'emergencyChanged(name_e, relation_e, phone_e, work_phone)',
        'mypatientChanged(mypatient)'
      ],

      mypatientChanged(e) {
        if (e.length > 0) {
          if (e[0].profile) {
            this.p_profile = e[0].profile;
          }
          else {
            this.p_profile = '../images/user.png';
          }

          if (e[0].personal.referred) {
            this.refer = e[0].personal.referred;
            if (e[0].personal.referred == 'Dr') {
              this.doctor = e[0].personal.doctor;
            }
          }

          this.email = e[0].personal.email;
          this.fname = e[0].personal.firstname;
          this.mname = e[0].personal.middlename;
          this.lname = e[0].personal.lastname;
          this.bday = e[0].personal.birthday;
          this.age = e[0].personal.age;
          this.contact = e[0].personal.contact;
          this.address = e[0].personal.address;
          this.occupation = e[0].personal.occupation;
          this.employer = e[0].personal.employer;
          this.emp_phone = e[0].personal.emp_phone;


          if (e[0].personal.sex == 'male') {
            this.sex = 0;
          }
          if (e[0].personal.sex == 'female') {
            this.sex = 1;
          }
          if (e[0].personal.status == 'single') {
            this.status = 0;
          }
          if (e[0].personal.status == 'married') {
            this.status = 1;
          }
          if (e[0].personal.status == 'divorced') {
            this.status = 2;
          }
          if (e[0].personal.status == 'separated') {
            this.status = 3;
          }
          if (e[0].personal.status == 'widowed') {
            this.status = 4;
          }

          this.card = e[0].insurance.card;
          this.bdate = e[0].insurance.birthday;
          this.in_address = e[0].insurance.address;
          this.home_phone = e[0].insurance.home_phone;
          this.indicate = e[0].insurance.primary_insurance;
          this.p_relation = e[0].insurance.relationship;

          this.name_e = e[0].emergency.name;
          this.relation_e = e[0].emergency.relationship;
          this.phone_e = e[0].emergency.home_phone;
          this.work_phone = e[0].emergency.work_phone;
        }
      },

      personalInfoChanged(doctor, refer, email, fname, mname, lname, bday, age, contact, address, occupation, employer, emp_phone, sex, status) {
        if (fname) {
          var c = fname.toLowerCase().replace(/\b[a-z]/g, function (letter) {
            return letter.toUpperCase();
          });
          this.fname = c;
          fname = c;
        }

        if (mname) {
          var c = mname.toLowerCase().replace(/\b[a-z]/g, function (letter) {
            return letter.toUpperCase();
          });
          this.mname = c;
          mname = c;
        }

        if (lname) {
          var c = lname.toLowerCase().replace(/\b[a-z]/g, function (letter) {
            return letter.toUpperCase();
          });
          this.lname = c;
          lname = c;
        }

        if (bday) {
          var mdate = bday.toString();
          var yearThen = parseInt(mdate.substring(0, 4), 10);
          var monthThen = parseInt(mdate.substring(5, 7), 10);
          var dayThen = parseInt(mdate.substring(8, 10), 10);

          var today = new Date();
          var birthday = new Date(yearThen, monthThen - 1, dayThen);

          var differenceInMilisecond = today.valueOf() - birthday.valueOf();

          var year_age = Math.floor(differenceInMilisecond / 31536000000);
          var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

          if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
            // alert("Happy B'day!!!");
          }

          var month_age = Math.floor(day_age / 30);

          day_age = day_age % 30;

          if (isNaN(year_age) || isNaN(month_age) || isNaN(day_age)) {
            // $("#exact_age").text("Invalid birthday - Please try again!");
          }
          else {
            this.age = year_age;
          }
        }
        else {
          this.age = age;
        }

        if (refer) {
          if (refer == 'Dr') {
            Polymer.dom(this.root).querySelector("#doctor").style.display = 'block';
            doctor = doctor;
            this.referredby = 'Dr. ' + doctor;
          }
          else {
            Polymer.dom(this.root).querySelector("#doctor").style.display = 'none';
            this.doctor = '';
            doctor = '';
            this.referredby = refer;
          }
        }
        else {
          refer = '';
        }

        if (sex == 0) {
          this.gender = 'male';
        }
        if (sex == 1) {
          this.gender = 'female';
        }
        if (status == 0) {
          this.stat = 'single';
        }
        if (status == 1) {
          this.stat = 'married';
        }
        if (status == 2) {
          this.stat = 'divorced'
        }
        if (status == 3) {
          this.stat = 'separated';
        }
        if (status == 4) {
          this.stat = 'widowed';
        }

        if (!fname || !mname || !lname) {
          this.favrighthide = true;
        }
        else {
          this.favrighthide = false;
          this.personal = {
            email: email,
            firstname: fname,
            middlename: mname,
            lastname: lname,
            birthday: bday,
            age: age,
            status: this.stat,
            sex: this.gender,
            contact: contact,
            address: address,
            occupation: occupation,
            employer: employer,
            emp_phone: emp_phone,
            referred: refer,
            doctor: doctor,
            name: lname + ' ' + fname + ' ' + mname
          }
        }
      },

      insuranceChanged(card, bdate, in_address, home_phone, indicate, p_relation) {
        this.insurance = {
          card: card,
          birthday: bdate,
          address: in_address,
          home_phone: home_phone,
          primary_insurance: indicate,
          relationship: p_relation
        }
      },

      emergencyChanged(name_e, relation_e, phone_e, work_phone) {
        this.emergency = {
          name: name_e,
          relationship: relation_e,
          home_phone: phone_e,
          work_phone: work_phone
        }
      },

      _changepic() {
        if (event.target.files[0]) {
          this.profile = event.target.files[0];
          Polymer.dom(this.root).querySelector("#profilePic").src = URL.createObjectURL(event.target.files[0]);
          this.p_profile = URL.createObjectURL(event.target.files[0]);
        }
      },

      toggleDrawer() {
        this.dispatchEvent(new CustomEvent('toggleDrawer', {
          bubbles: true, composed: true, detail: {
            narrow: this.$.narrow
          }
        }));
        this.$.narrow = !this.$.narrow;
      },

      ready() {
        this.selectedPage = 0;
        this.favrighthide = false;
      },

      _select1(e) {
        this.entryanimation = "slide-from-left-animation";
        this.exitanimation = "slide-right-animation";

        if (parseInt(this.selectedPage) <= 5) {
          if (parseInt(this.selectedPage) !== 0) {
            this.selectedPage = (parseInt(this.selectedPage) - 1);

            if (this.selectedPage === 0) {
              this.favlefthide = true;
            }

            if (this.selectedPage == 4) {
              this.favrighthide = true;
            }
            else {
              Polymer.dom(this.root).querySelector("#favright").setAttribute("style", "background: #1976d2;");
              Polymer.dom(this.root).querySelector("#favright").setAttribute("icon", "my-icons:chevron-right");
              this.favrighthide = false;
            }

          }
          else {
            this.favlefthide = true;
            this.favrighthide = false;
          }
        }
        else {
          this.selectedPage = 5;
        }

      },

      _select2(e) {
        this.entryanimation = "slide-from-right-animation";
        this.exitanimation = "slide-left-animation";

        if (parseInt(this.selectedPage) >= 0) {

          if (parseInt(this.selectedPage) == 0) {
            if (!this.fname || !this.mname || !this.lname) {
              this.favlefthide = false;
              this.favrighthide = true;
            }
            else {
              this.favlefthide = false;
              this.favrighthide = false;
            }
          }

          // if (parseInt(this.selectedPage) == 1) {
          //   if (!this.card || !this.bdate || !this.in_address || !this.home_phone || !this.indicate || !this.p_relation) {
          //     this.favlefthide = false;
          //     this.favrighthide = true;
          //   }
          //   else {
          //     this.favlefthide = false;
          //     this.favrighthide = false;
          //   }
          // }

          // if (parseInt(this.selectedPage) == 2) {
          //   if (!this.name_e || !this.relation_e || !this.phone_e || !this.work_phone) {
          //     this.favlefthide = false;
          //     this.favrighthide = true;
          //   }
          //   else {
          //     this.favlefthide = false;
          //     this.favrighthide = false;
          //   }
          // }

          if (parseInt(this.selectedPage) == 4) {
            //complete
            var info = this.personal, insure = this.insurance, emerg = this.emergency, key = this.editKey;
            var mykey = this.myKey;
            if (this.profile) {
              var pic_name = this.guid();
              var storageRef = firebase.storage().ref('profilePicture/' + pic_name);
              var uploadTask = storageRef.put(this.profile);

              firebase.database().ref('/' + mykey + '/patients/' + key)
                .once('value').then(function (patient) {
                  if (patient.val().profile) {
                    firebase.storage().refFromURL(patient.val().profile).delete()
                      .then(function () {
                        uploadTask.on('state_changed',
                          function () {
                            var downLoadURL = uploadTask.snapshot.downloadURL;
                            if (downLoadURL) {

                              var ref = firebase.database().ref("/" + mykey + "/patients/" + key);
                              var push = ref.update({
                                personal: info,
                                insurance: insure,
                                emergency: emerg,
                                profile: downLoadURL
                              });
                            }
                          });
                      });
                  }
                  else {
                    uploadTask.on('state_changed',
                      function () {
                        var downLoadURL = uploadTask.snapshot.downloadURL;
                        if (downLoadURL) {

                          var ref = firebase.database().ref("/" + mykey + "/patients/" + key);
                          var push = ref.update({
                            personal: info,
                            insurance: insure,
                            emergency: emerg,
                            profile: downLoadURL
                          });
                        }
                      });
                  }
                });
            }
            else {
              var ref = firebase.database().ref("/" + mykey + "/patients/" + key);
              var push = ref.update({
                personal: this.personal,
                insurance: this.insurance,
                emergency: this.emergency
              });
            }
            this.saveSuccess = 'Patient successfully updated.';
          }

          if (parseInt(this.selectedPage) !== 5) {

            this.selectedPage = (parseInt(this.selectedPage) + 1);

            if (parseInt(this.selectedPage) == 4) {
              Polymer.dom(this.root).querySelector("#favright").setAttribute("style", "background: green;");
              Polymer.dom(this.root).querySelector("#favright").setAttribute("icon", "my-icons:done");
            }

            if (parseInt(this.selectedPage) == 5) {
              this.favlefthide = false;
              this.favrighthide = true;
            }
          }
        }
        else {
          this.selectedPage = 0;
          this.favlefthide = true;
          this.favrighthide = false;
        }
      },

      guid: function () {
        var uid = new ShortUniqueId();
        return uid.randomUUID(8);
      },
    })
  </script>
</dom-module>