<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">

<dom-module id="my-queue-card">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            .primary {
                font-size: 14px;
                font-weight: 400;
            }

            .shortText,
            .longText {
                font-size: 14px;
            }

            .longText {
                color: gray;
                /* display: none; */
            }

            .item_D {
                @apply --layout-horizontal;
                padding: 15px;
                background-color: white;
                border-bottom: 1px solid #ddd;
                cursor: pointer;
                opacity: 0.3;
            }

            .item_N {
                @apply --layout-horizontal;
                padding: 15px;
                background-color: white;
                border-bottom: 1px solid #ddd;
                cursor: pointer;
                opacity: 0.6;
            }

            .item_N:hover,
            .item_D:hover {
                opacity: 1;
                box-shadow: 0 6px 20px 0px rgba(0, 0, 0, 0.2);
            }

            .avatar {
                height: 45px;
                width: 45px;
                border: 2px solid white;
                border-radius: 50%;
                box-sizing: border-box;
                background-color: #DDD;
            }

            .pad {
                /* border-left: 6px solid rgb(208, 137, 236); */
                margin-left: 10px;
                /* padding: 10px; */
                @apply --layout-flex;
                @apply --layout-vertical;
            }

            .item {
                @apply --layout-horizontal;
                padding: 15px;
                background-color: white;
                border-bottom: 1px solid #ddd;
                cursor: pointer;
                box-shadow: 0 6px 20px 0px rgba(0, 0, 0, 0.2);
                /* counter-reset: section; */
                /* opacity: 0.5; */
                /* margin-bottom: 5px; */
            }

            .cancel {
                transform: rotate(-25deg);
                display: none;
                /* position: absolute;
                right: 27px;
                top: 27px; */
                color: #F44336;
                font-size: 12px;
                padding: 4px;
                border: 2px solid #F44336;
                border-radius: 6px;
                height: 17px;
                margin-top: 8px;
            }
        </style>

        <div class$="[[getClassForItem(item.isNext, item.isQueue)]]" tabindex$="[[tabIndex]]">
            <div style="font-size:16px;" class="longText">[[item.queueNo]]</div>
            <div style="padding:6px"></div>
            <div>
                <iron-image preload fade class="avatar" sizing="cover" src$="{{_patientImg(item.patient_profile)}}"></iron-image>
            </div>
            <div class="pad">
                <div style="font-size:11px" class="longText">[[item.patient_no]]</div>
                <div class="primary">[[item.patient_info.lastname]], [[item.patient_info.firstname]] [[item.patient_info.middlename]]
                </div>
                <div class="longText">{{_ageCal(item.patient_info.birthday)}}{{_comma(item.patient_info.birthday)}} [[item.patient_info.sex]]
                </div>
                <div class="longText">[[_hmo(item.patient_info.hmo)]]</div>
            </div>

            <div style$="{{_isCancel(item.isCancel)}}" class="cancel">Cancelled</div>
        </div>

    </template>
    <script>
        Polymer({
            is: 'my-queue-card',
            properties: {
                item: Object
            },

            getClassForItem(isNext, isQueue) {
                if (!isNext && !isQueue) return 'item_D';
                else if (!isNext && isQueue) return 'item_N';
                else return 'item';
            },

            _ageCal(bday) {
                if (bday) {

                    var today = new Date();
                    var birthday = new Date(bday);

                    var differenceInMilisecond = today.valueOf() - birthday.valueOf();

                    var year_age = Math.floor(differenceInMilisecond / 31536000000);
                    var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

                    var month_age = Math.floor(day_age / 30);

                    day_age = day_age % 30;

                    if (!isNaN(year_age) || !isNaN(month_age) || !isNaN(day_age)) {
                        if (year_age > 0) {
                            if (year_age == 1) {
                                return year_age + " year old";
                            }
                            else {
                                return year_age + " years old";
                            }
                        }
                        else if (year_age == 0 && month_age > 0) {
                            if (month_age == 1) {
                                return month_age + " month old";
                            }
                            else {
                                return month_age + " months old";
                            }
                        }
                        else if (year_age == 0 && month_age == 0 && day_age > 0) {
                            if (day_age == 1) {
                                return day_age + " day old";
                            }
                            else {
                                return day_age + " days old";
                            }
                        }
                        else {
                            return year_age + " years " + month_age + " months " + day_age + " days old";
                        }
                    }
                }
                else {
                    return '';
                }
            },

            _comma(e) {
                if (e) {
                    return ',';
                }
            },

            _hmo(e) {
                if (e) {
                    return 'HMO: ' + e;
                }
            },

            _patientImg(e) {
                if (e) return e;
                else return '../images/user.png';
            },

            _isCancel(e) {
                if (e) return 'display:inline-block';
            },


        })
    </script>
</dom-module>